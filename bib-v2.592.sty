
%%% BIB.STY -- verze 2.592/ctx:tl2019 (c) TH, 1999--2020

%%% ===================================================================================================================================================
%%%%%%%%% Značkovací styl pro rychlou sazbu bibliografických citací
%%%%%%%%% Markup Style for Fast Typesetting of Bibliographic References
%%% ===================================================================================================================================================
%%% Copyright 1999--2020 Tomáš Hála, konvoj@konvoj.cz, thala@mendelu.cz
%%% http://www.konvoj.cz/styles/biblio/

%%% Kódování: UTF-8
%%% Dokumentace: Rozpracovaná verze: www.konvoj.cz/styles/biblio/,
%%%       	 něco málo je v Zpravodaji CSTUG, 2008, č. 3.
%%% Licence: volně šiřitelné, volně užitelné, neprodejné, nemodifikovatelné vyjma překódování češtiny, dále
%%%          v intencích licencí pro TeX, ConTeXt a LaTeX. Změny či doplňky umisťujte do vlastního stylu.
%%% Odpovědnost: Užití stylu výhradně na vlastní odpovědnost uživatele stylu. Autor tohoto stylu nenese odpovědnost za vůbec, ale vůbec nic.
%%% Citujete-li, použijte tento vzor:
%%%	Hála, Tomáš. BIB.STY : Značkovací styl pro rychlou sazbu bibliografických citací [on-line]. 
%%%        Verze 2.58. c2020 [cit. 2020-mm-dd]. Dostupné na: http://www.konvoj.cz/styles/biblio/.
%%%
%%% Encoding: UTF-8
%%% Documentation: Unfinished version: www.konvoj.cz/styles/biblio/.
%%%                The basic introduction has been published in Zpravodaj CSTUG, 2008, no. 3., in Czech.
%%% Licence agreement: free for distribution, free for use, unmodifiable except encoding of Czech national characters.
%%%	     Handle it similarly as you handle with TeX, ConTeXt, and LaTeX. Changes or additions, please, put in your own style.
%%% Responsibility: Author of this style does not bare responsiblity for usage of this style.
%%% If cited, use the following: 
%%%	Hála, Tomáš. BIB.STY : Značkovací styl pro rychlou sazbu bibliografických citací [Markup Style for Fast Typesetting of Bibliographic References] [on-line]. 
%%%        Verze 2.581. c2020 [cit. 2020-mm-dd]. Available at: http://www.konvoj.cz/styles/biblio/.
%%%
%%%  This work has the maintenance status `Maintained'.
%%%  The Current Maintainer of this work is Tomáš Hála.
%%%
\def\BIBSTYversion{BIB.STY v. 2.592}
%%% Version 2.591 leftskip 3.25cc-->3.75em?? 
%%% Version 2.59  \fonturi=\tf+features; \doneO
%%% Version 2.583 \publZ correction; leftskip 2cc-->3.25cc; redundant space at xis?b
%%% Version 2.582 \publP+G+H: output corr., incl. \biblNazev, \biblNakl; publG+H+P tested for online; dimexpr
%%% Version 2.581 clean-up the code II.; \nopubl; \doneF added; \publN checked (ok); \publP-->X, \publPX-->XX; \publF-->P (mnemotechnic); 
%% 		  \publG+H+O first steps; \biblWww; Edice+svazek (only A); \Dil for C+E
%%% Version 2.58  \fonturi=\tt; bib-en inside; BIBSTYmainlanguage (complete solution for CTX)
%%% Version 2.574 \eds, clean-up, fonturi
%%% Version 2.573 correction of 2.572
%%% Version 2.572 clean-up the code; 
%%% Version 2.571 oprava: Podnazev v \biblNazev. publT: supervisor
%%% Version 2.570 Podnazev v \biblNazev
%%% Version 2.569 \akol: authorfullname; BIBSTY@auxmacros, BIBSTYversion
%%% Version 2.567 \akol: authorfullname
%%% Version 2.566 \akol: netecka
%%% Version 2.565 {\sc} \red->\reda
%%% Version 2.564 \cast: \bbib redef.
%%% Version 2.563 correction \publC
%%% Version 2.562 semicolor for authors
%%% Version 2.561 \az: \let-->\def; D:\Umist.
%%% Version 2.560 added online \publE without pages + corrections
%%% ===================================================================================================================================================

%%% OBECNÁ NASTAVENÍ / BASIC SETTINGS
\hyphenation{ISBN ISSN ISMN}
\catcode`\_=12 
\catcode`\&=12 

%%% "WHO AM I"

\newif\ifConTeXt\ConTeXtfalse
\newif\ifLaTeX\LaTeXfalse
\ifx\contextversion\undefined\else\ConTeXttrue\fi
\ifx\usepackage\undefined\else\LaTeXtrue\fi%RequiredPackage 
\catcode`\@=11
\ifConTeXt\else\def\crlf{\\}\fi

%%% GENERAL DEFINTIONS

\newif\ifwwwadditive\wwwadditivefalse
\newif\ifBIBSTYvydaninepovinne\BIBSTYvydaninepovinnetrue
\newif\ifBIBSTYediceuvadime\BIBSTYediceuvadimefalse

%%% ERRORS

\newif\ifBIBSTYreport\BIBSTYreportfalse
\def\BIBSTYreport#1{\par\thinrule\startcolor[red]#1\stopcolor\par}
\def\BIBSTYreporttype{\par\thinrule\startcolor[blue]\biblTyp\stopcolor\par}
\def\BIBSTYerrmessage#1{\ifBIBSTYreport\BIBSTYreport{#1}\else\errmessage{#1}\fi}


% Úprava kvůli CTX v TL2017: nyní opravujeme

\ifConTeXt
  \def\typesetorbreak#1{#1}
\else % Non CTX
  \newdimen\lastlinewidth
  \newdimen\lastlinewidthfree
  \newdimen\lastlineauxillary
  \lastlineauxillary=-1em %-3em%původně: %1.6667em%hodnota 3.33 je zjištěna experimentálně pro lmr10
  \lastlineauxillary=1em %-3em%původně: %1.6667em%hodnota 3.33 je zjištěna experimentálně pro lmr10
%
  \def\testlastline{%
    \ifhmode $$ \advance\predisplaysize by\lastlineauxillary
      \global\lastlinewidth=\predisplaysize%
      \lastlinewidth=\predisplaysize%
      \predisplaysize=\maxdimen%
      \abovedisplayskip=-\baselineskip%
      \belowdisplayskip=0pt $$\endgraf\fi}%
%
  \def\typesetorbreak#1{\setbox0=\hbox{#1}%
     \testlastline%
     \lastlinewidthfree=\textwidth%
     \advance\lastlinewidthfree by -\lastlinewidth%
     \vskip-\baselineskip%
     \hskip\lastlinewidth%
     \ifdim\wd0>\lastlinewidthfree\crlf\unskip\fi#1}%
\fi

%%% pokusná sekce...

\def\ippom{~-- }
\def\bibperc{\%}  %\symbol{37}

%%% BASIC SETTINGS

\gdef\BIBSTY@language{cs}
\def\BIBSTY@uselanguage{\ifConTeXt\mainlanguage[\BIBSTY@language]\else\ifLaTeX \else\fi\fi}
\def\BIBSTYmainlanguage[#1]{\gdef\BIBSTY@language{#1}}
%\BIBSTYmainlanguage[cs]

\def\typesetAZ{\discretionary{}{až\kern0.3333em}{\endash}}
\def\AZ{\typesetAZ}
\def\az{\typesetAZ}
\ifx\refname\undefined\def\refname{Literatura}\fi

\ifConTeXt % BASIC SETTINGS FOR CONTEXT
  \ifx\undefined\BIBSTYrefs%
     \definehead[BIBSTYrefs][chapter]
     \setuphead[BIBSTYrefs][number=no,page=no]
     \setuplist[BIBSTYrefs][headnumber=no]
  \fi
%  \def\value#1{\csname #1\endcsname}
  \def\bib@url#1{\hyphenatedurl{#1}}
  \def\setcounter#1#2{\csname #1\endcsname=#2}
  \def\arabic{}
  \sethyphenatedurlnormal{:=?&_}
  \sethyphenatedurlbefore{:=?&_}
  \sethyphenatedurlafter{:=?&_}
 \else
\ifLaTeX % BASIC SETTINGS FOR LATEX
  %\RequirePackage{url}  % preambule
  %\usepackage{url} 
  %%% Nasavení pro url.sty  
  \def\UrlNoBreaks{%\do\.\do\:
  \do\(\do\[\do\{\do\<}% \.\: added by TH
  \def\bib@url#1{\url{#1}}
  \def\crlf{\\}
\else % BASIC SETTINGS FOR PLAIN
  \let\textwidth=\hsize  
  \def\bib@url{}
\fi\fi

%%% Pomocné makropříkazy -- public

\newif\ifbib@cdrom\bib@cdromfalse
\def\cdrom{\bib@cdromtrue}
\let\CDROM=\cdrom

\def\BIBSTY@auxmacros{
  \def\stran{~s.}
  \def\Listu{~listů}
  \def\Rocnik{Roč.~}
  \def\textVerze{Ver.~}
  \def\Dostupne{Do\-stupné\penalty-5000{} na}
  \def\Dostupnetez{dostupné\penalty-5000{} též na}
  \def\akol{\bib@space{\fontautordod{}a~kol\if@tecka\ifbib@authorfullname\else.\fi\fi}}
  \def\reda{\bib@space{\fontautordod(red.)}}
  \def\ed{\bib@space{\fontautordod(ed.)}}
  \def\eds{\bib@space{\fontautordod(eds.)}}
  \def\editori{\bib@space{\fontautordod(editoři)}}
  \def\editorky{\bib@space{\fontautordod(editorky)}}
  \def\bibtext@online{\fontbibtext@online\bib@space\hbox{[on-line]}}
  \def\cdromtext{\fontbibtext@online\bib@space[CD-ROM]}
  \def\meritkotext{\fontbibtext@online\bib@space Měřítko}
  \def\vydanitext{vyd.}
  \def\vedouciprace{Vedoucí práce}
  \def\pagesname{s.}
  \def\pagesnameone{s.}
  \def\biblumistpagesname{\pagesname}
  \def\In{In}
  \def\inpr{\@vtiskutrue\umist{0}{0}}
  \let\inpress\inpr
%
  \def\@BIBSTYlangtest{sk}\ifx\@BIBSTYlangtest\BIBSTY@language
  % Slovak output from BIB.STY since v. 2.58
    \def\Dostupnetez{dostupné\penalty-5000{} tiež na}
    \def\editori{\bib@space{\fontautordod(editori)}}
    \def\meritkotext{\fontbibtext@online\bib@space Mierka}
    \def\vedouciprace{Vedúci práce}
    \def\Listu{~listov}
    \def\bakprace{\gdef\Thesis{Bakalárska práca}}
    \def\dipprace{\gdef\Thesis{Diplomová práca}}
  \else\def\@BIBSTYlangtest{en}\ifx\@BIBSTYlangtest\BIBSTY@language
  % English output from BIB.STY since v. 2.58
    \def\stran{~pp.}
    \def\Listu{~sheets} 
    \def\Rocnik{Vol.~}
    \def\Dostupne{Available at}
    \def\Dostupnetez{available also at}
    \def\akol{\bib@space{\fontautordod{}et~al.}}
    \def\ed{\bib@space{\fontautordod(ed.)}}
    \def\eds{\bib@space{\fontautordod(eds.)}}
    \def\meritkotext{\bib@space{\fontbibtext@online Scale}}
    \def\vydanitext{ed.}
    \def\vedouciprace{Supervisor}
    \def\pagesname{p.}
    \def\pagesnameone{p.}
    \def\bakprace{\gdef\Thesis{Bachelor thesis}}
    \def\dipprace{\gdef\Thesis{Diploma thesis}}
    \def\refname{References}
    \def\pressname{in press}
  % English interface to BIB.STY since v. 2.58
    \let\author=\autor
    \let\authorcorp=\autorkorp
    \let\authordoc=\autordok
    \let\title=\nazev
    \let\subtitle=\podnazev
    \let\subauthor=\podpov
    \let\edi=\vyd
    \let\part=\cast
    \let\pubh=\nakl
    \let\yop=\rok
    \let\mscale=\meritko
    \let\pages=\rozsah
    \let\range=\umist
    \let\Rrange=\Rumist
    \let\rrange=\rumist
    \let\trange=\tumist
    \let\edition=\edice
    \let\note=\pozn
    \let\bcthesis=\bakprace
    \let\mathesis=\dipprace
    \let\phdthesis=\disprace
    \let\pgs=\stran
    \let\sheets=\Listu
    \let\Vol=\Rocnik
    \let\etal=\akol
    \let\bcthesis=\bakprace
    \let\mathesis=\dipprace
    \let\nodot=\netecka
    %%% BASIC SETTINGS
    \def\typesetAZ{\discretionary{}{to\kern0.3333em}{\endash}}
    \let\typesetTO=\typesetAZ
    %%% Font commands
    \let\fontauthor=\fontautor
    \let\fontauthoradd=\fontautordod
    \let\fontauthorcorp=\fontautorkorp
    \let\fontreference=\fontcitace
    \let\fontavail=\fontdostupnost
    \let\fonttitle=\fontnazev
    \let\fontscale=\fontmeritko
    %% Test commands
    \let\@authortest=\@autortest
    \let\@titletest=\@nazevtest
    \let\@yoptest=\@roktest
    \let\@rangetest=\@rozsahtest
    \let\@publtest=\@nakltest
    \let\@authordoctest=\@autordoktest
    \let\@editest=\@vydtest
    \let\@parttest=\@casttest
    \let\@scaletest=\@meritkotest
    \let\@pagestest=\@rozsahtest
    \let\@citdatetest=\@datcittest
    \let\@subtitletest=\@podnazevtest
  \fi\fi%
}

%%% Pomocné makropříkazy -- private

\def\inseznam{}
\def\inhotovo{}
\def\pressname{v~tisku}
\newif\if@tecka\@teckatrue
\def\netecka{\@teckafalse}
\def\@Tecka{\if@tecka.\fi\@teckatrue}
\def\bib@space{\unskip\penalty-9999{} }
\def\bib@authordelim{\ifbib@authorfullname;\else,\fi}
\def\bib@spaceisbn{\hbox to-2.5em{}}
\def\bib@spaceisbn{}%\hbox to -1.25\leftskip{}}
\def\bib@spaceaut{\kern0.6667em}
\def\bib@spaceaut{\kern0.36667em}
\def\bib@null{}
\def\bib@empty#1#2{\ifx\bib@null#1\BIBSTYerrmessage{#2}\else\if*#1\BIBSTYerrmessage{#2}\fi\fi}

%%% TESTY / TESTS

\def\@autortest{\ifautor@bib\bib@empty{\Autori}{Není uveden autor./Missing author.}\fi} 
\def\@puvodcetest{\ifautor@bib\bib@empty{\Autori}{Není uveden autor nebo původce./Missing author or originator.}\fi} 
\def\@autordoktest{\bib@empty{\Autordoki}{Není uveden autor zdrojového dokumentu./Missing author of the source document.}} % ???
\def\@majiteltest{\ifautor@bib\bib@empty{\Majitel}{Není uveden majitel patentu./Missing owner of the patent.}\fi} 
\def\@nazevtest{\bib@empty{\Nazev}{Není uveden název./Missing title.}}
\def\@nazevdoktest{\bib@empty{\Nazevdok}{Není uveden název zdrojového dokumentu./Missing title of the source document.}}
\def\@vydtest{\ifBIBSTYvydaninepovinne\else\if@vtisku\else\bib@empty{\Vyd}{Není uvedeno vydání./Missing edition.}\fi\fi}
\def\@verzetest{\bib@empty{\Verze}{Není uvedena verze./Missing version.}}
\def\@roktest{\if@vtisku\else\bib@empty{\Rok}{Není uveden rok vydání./Missing year of publication.}\fi}
\def\@roktestB{\if*\Rok Není uveden rok vydání./Missing year of publication.\fi}
\def\@roktestBy{\iftrue\else\@casttext\fi}%
\def\@nakltest{\if@vtisku\else\bib@empty{\Sidlo}{Není uvedeno sídlo nakladatele./Missing publisher's site.}\bib@empty{\Nakla}{Není uveden název nakladatele./Missing publisher's name.}\fi}
\def\@isbntest{\if*\Isbn\message{Není uvedeno číslo ISBN./Missing ISBN.}\fi}
\def\@issntest{\if*\Issn\message{Není uvedeno číslo ISSN./Missing ISSN.}\fi}
\def\@ismntest{\if*\Ismn\message{Není uvedeno číslo ISMN./Missing ISMN.}\fi}
\def\@casttest{\if@vtisku\else\def\hlasitchybu{-}\if E\biblTyp\if*\Cast\def\hlasitchybu{+}\fi\fi%
	\if C\biblTyp\if*\Dil\def\hlasitchybu{+}\fi\fi%
	\if+\hlasitchybu\bib@empty{\Cast}{Není uvedeno číslo části./Missing part number.}\fi\fi}
\def\@umisttest{\if@vtisku\else\if@online\else\bib@empty{\Umist}{Není uvedeno umístění ve zdrojovém dokumentu./Missing pages.}\fi\fi}
\def\@thesistest{\bib@empty{\Thesis}{Není uveden typ práce./Missing type of thesis.}}
\def\@podnazevtest{\bib@empty{\Podnazev}{Není uveden podnázev./Missing subtitle.}}
\def\@rozsahtest{\bib@empty{\Rozsah}{Není uveden rozsah práce./Missing pages.}}
%\def\@datcittest{\bib@empty{\Www}{\relax\bib@empty{\Datumcitace}{Není uvedeno datum citace./Missing date of citation.}}} %% 201611301648: toto nejde přepsat pro bib@empty kvůli složitější podmínce
\def\@datcittest{\if*\Www\else\bib@empty{\Datumcitace}{Není uvedeno datum citace./Missing date of citation.}\fi}
\def\@meritkotest{\bib@empty{\Meritko}{Není uvedeno měřítko./Missing scale.}}
\def\@wwwtest{%\color[red]{\Www \Datumcitace}  %% 201611301403: toto nejde přepsat pro bib@empty kvůli složitější podmínce
  \if@online{\if*\Www\BIBSTYerrmessage{Není uvedena dostupnost v síti./Missing URL.}\else\bib@empty{\Datumcitace}{Není uvedeno datum citace./Missing date of citation.}\fi}\fi\@datcittest}

\def\@wwwtestx{%\color[red]{\Www \Datumcitace}
  \bib@empty{\Www}{Není uvedena dostupnost v síti./Missing URL.}
  \bib@empty{\Datumcitace}{Není uvedeno datum citace./Missing date of citation.}%\@datcittest
}
\def\@issntestx{}%\if*\Issn\else\BIBSTYerrmessage{Obsahuje atribut ISSN./Extra ISSN.}\fi}
%%%%%%%%%%%% !!!! 20140519

\def\BIBSTY@testA{\@autortest\@nazevtest%\@vydtest
	\@rozsahtest\@roktest\@nakltest\@isbntest\@wwwtest}
\def\BIBSTY@testB{\@autortest\@nazevtest\@vydtest\@roktestB\@roktestBy\@nakltest\@issntest}
\def\BIBSTY@testC{\@autortest\@nazevdoktest\@vydtest\@casttest\@roktest\@nakltest\@isbntest\@umisttest}
\def\BIBSTY@testD{\@autortest\@nazevtest%\@autordoktest
	\@nazevdoktest%\@vydtest
	\@nakltest\@roktest\@isbntest\@umisttest
	\@issntestx\@wwwtest}
\def\BIBSTY@testE{\@autortest\@nazevtest\@nazevdoktest\@casttest\@roktest\@umisttest\@issntest\@wwwtest}
\def\BIBSTY@testG{\@autortest\@nazevtest\@roktest}%
\def\BIBSTY@testH{\@autortest\@nazevtest}%
\def\BIBSTY@testM{\BIBSTY@testA\@meritkotest}%
\def\BIBSTY@testN{\@nazevtest\@vydtest\@roktest\@wwwtest}%\@nakltest
\def\BIBSTY@testO{\@puvodcetest\@nazevtest\@nakltest\@roktest\@wwwtest\if@fond\@nazevdok\@casttest\fi}%

\def\BIBSTY@testP{\@majiteltest\@nazevtest\@nazevdoktest\@roktest\@casttest\@wwwtest}%
\def\BIBSTY@testX{\@autortest\@nazevtest%\@roktest
  % roktest dočasně vyhozen, rok se nemusí uvádět, pokud je datum citace
\@wwwtest}%\@nakltest
\def\BIBSTY@testXX{%\@autortest
	\@nazevtest%\@roktest
	\@wwwtest}%\@nakltest
\def\BIBSTY@testS{\@nazevtest\@verzetest\@wwwtest}
\def\BIBSTY@testT{\@autortest\@nazevtest\@roktest\@nakltest\@rozsahtest\@thesistest\@wwwtest}
\def\BIBSTY@testX{}%\BIBSTY@initif\@autortest\@nazevtest}
\def\BIBSTY@testW{\@autortest\@nazevtest%\@autordoktest
	\@nazevdoktest%\@vydtest%\@nakltest
	\@roktest%\@isbntest%\@umisttest%\@issntestx
	\@wwwtestx}
\def\BIBSTY@testZ{\@nazevtest\@datcittest%\@wwwtest\@wwwtest
    }%\@nakltest

\newif\ifNakladatel
\newif\if@vtisku\@vtiskufalse
\newif\if@online\@onlinefalse
\newif\if@fond\@fondtrue
\newif\ifbib@authorfullname\bib@authorfullnamefalse
\def\BIBSTYauthorfullname{\bib@authorfullnametrue}
\newif\ifbib@authordokfullname\bib@authordokfullnamefalse

\ifLaTeX\newcounter{UmistOd}\newcounter{UmistDo}\else\newcount\UmistOd\newcount\UmistDo\fi

%%% Makropříkazy pro elementy (\gdef bude časem upraveno)

\gdef\autor#1{\if*\Autori\gdef\Autori{#1}\else\if*\Autorii\gdef\Autorii{#1}\else
  \if*\Autoriii\gdef\Autoriii{#1}\else\BIBSTYerrmessage{Uvádějí se nejvýše tři autoři./More than three authors.}\fi\fi\fi}
\def\autorkorp#1{\autor{{\fontautorkorp#1\ifbib@authorfullname\else\@Tecka\fi}}}
\def\majitel#1{{\gdef\Majitel{#1}\ifbib@authorfullname\else\@Tecka\fi}}
\def\majitelkorp#1{\majitel{{\fontautorkorp#1\ifbib@authorfullname\else\@Tecka\fi}}}

\gdef\autordok#1{\if*\Autordoki\gdef\Autordoki{#1}\else\if*\Autordokii\gdef\Autordokii{#1}\else
  \if*\Autordokiii\gdef\Autordokiii{#1}\else\BIBSTYerrmessage{Uvádějí se nejvýše tři autoři zdrojového dokumentu../More than three authors of the source document.}\fi\fi\fi}

\newif\iftext@bib\text@bibfalse
\newif\ifautor@bib\autor@bibtrue
\newif\ifautordok@bib\autordok@bibtrue
\def\autorne{\autor@bibfalse}
\def\autordokne{\autordok@bibfalse}
\def\fondne{\@fondfalse}

%%% %%% Varianta, která nefunguje, doplňky jsou kvůli LaTeXu(?) a něco pokazily
%%% \gdef\bib@umist#1#2#3{%\errmessage{#1::#2::#3}
%%%     \def\@poma{*}\def\@pomb{#3}\ifx\@poma\@pomb\text@bibtrue\fi%
%%%     \iftext@bib\def\UmistOd{#1}\else\ifLaTeX\setcounter{UmistOd}{#1}\else\UmistOd=#1\fi\fi%
%%%     \def\@poma{#2}\def\@pomb{N}%
%%%     \def\biblumistpagesname{\pagesname}%
%%%     \ifx\@poma\@pomb\gdef\Umist{\iftext@bib\UmistOd\else\ifLaTeX#3{UmistOd}\else#3{\the\UmistOd}\fi\fi{} a~násl.}%
%%%       \else\iftext@bib\def\UmistDo{#2}%
%%% %	 	\gdef\Umist{\ifx\UmistDo\UmistOd\def\biblumistpagesname{\pagesnameone}\UmistOd%
%%% %		    		\else\UmistOd\typesetAZ\UmistDo\fi}%
%%%               \else\ifLaTeX\setcounter{UmistDo}{#2}\else\UmistDo=#2\fi%
%%%                  \gdef\Umist{
%%% \ifLaTeX\else
%%%  		     \ifnum\UmistOd>\UmistDo\BIBSTYerrmessage{Špatně uvedený rozsah./Improper range of pages.}\fi%
%%%  		     \ifnum\UmistOd=\UmistDo\def\biblumistpagesname{\pagesnameone}\else\typesetAZ#3{\the\UmistDo}\fi%
%%% \fi%
%%% \ifLaTeX#3{UmistOd}\else#3{\the\UmistOd}\fi--\ifLaTeX#3{UmistDo}\else#3{\the\UmistDo}\fi
%%% 		   }%
%%% 	\fi%
%%%    \fi%
%%% }

\gdef\bib@umist#1#2#3{\def\@poma{*}\def\@pomb{#3}\ifx\@poma\@pomb\text@bibtrue\fi%
    \iftext@bib\def\UmistOd{#1}\else\UmistOd=#1\fi%
    \def\@poma{#2}\def\@pomb{N}%
    \def\biblumistpagesname{\pagesname}%
    \ifx\@poma\@pomb\gdef\Umist{\iftext@bib\UmistOd\else#3{\the\UmistOd}\fi{} a~násl.}%
      \else\iftext@bib\def\UmistDo{#2}%
	 	\gdef\Umist{\ifx\UmistDo\UmistOd\def\biblumistpagesname{\pagesnameone}\UmistOd%
		    		\else\UmistOd\typesetAZ\UmistDo\fi}%
              \else\UmistDo=#2%
                 \gdef\Umist{#3{\the\UmistOd}%
 		     \ifnum\UmistOd>\UmistDo\BIBSTYerrmessage{Špatně uvedený rozsah./Improper range of pages.}\fi%
 		     \ifnum\UmistOd=\UmistDo\def\biblumistpagesname{\pagesnameone}\else\typesetAZ#3{\the\UmistDo}\fi%
		   }%
	\fi%
   \fi%
}

\gdef\umist#1#2{\bib@umist{#1}{#2}{\arabic}}
\gdef\Rumist#1#2{\bib@umist{#1}{#2}{\Roman}}
\gdef\rumist#1#2{\bib@umist{#1}{#2}{\roman}}
\gdef\tumist#1#2{\bib@umist{#1}{#2}{*}}
\ifx\bib@ISNtextcase\undefined\let\bib@ISNtextcase=\relax\fi

\gdef\edice#1{\gdef\Edice{#1}}
\gdef\svazek#1{\gdef\Svazek{#1}}
\gdef\pozn#1{\gdef\Pozn{#1}}
%\gdef\poznang#1{\gdef\Poznang{#1}}
\gdef\private#1{\gdef\Private{#1}}

\gdef\@isnbox{}

%\gdef\issnbox#1{\hbox{#1}}
%\gdef\ismnbox#1{\hbox{#1}}
%\gdef\issn#1{\gdef\Issn{{\fontISNtext\bib@ISNtextcase{ISSN}}~\penalty8000\isbnbox{#1}}}
%\gdef\ismn#1{\gdef\Ismn{{\fontISNtext\bib@ISNtextcase{ISMN}}~\penalty8000\isbnbox{#1}}}

\gdef\isbn#1{\gdef\Isbn{#1}}
\gdef\issn#1{\gdef\Issn{#1}}
\gdef\ismn#1{\gdef\Ismn{#1}}

%\gdef\@isbnbox{\fontISNtext\bib@ISNtextcase{ISBN}\penalty10000\ \hbox{#1}}}
%\gdef\issn#1{\gdef\@issnbox{\fontISNtext\bib@ISNtextcase{ISSN}\penalty10000\ \hbox{#1}}}
%\gdef\ismn#1{\gdef\@ismnbox{\fontISNtext\bib@ISNtextcase{ISMN}\penalty10000\ \hbox{#1}}}

\gdef\biblISN{%nastavení ohraničení
\ifConTeXt\def\typesetorbreak##1{\hbox{##1}}\fi
  \gdef\IsnBefore{}\gdef\IsnAfter{.}%
  \if C\biblTyp\gdef\IsnBefore{(}\gdef\IsnAfter{.)}\fi%
  \if D\biblTyp\gdef\IsnBefore{(}\gdef\IsnAfter{.)}\fi%
  \if E\biblTyp\gdef\IsnBefore{(}\gdef\IsnAfter{.)}\fi%
  %isbn+ismn
  \def\@isbnbox{ISBN\penalty10000\ \Isbn}%
  \def\@issnbox{ISSN\penalty10000\ \Issn}%
  \def\@ismnbox{ISMN\penalty10000\ \Ismn}%
  \def\@isbmnbox{%
    \if*\Isbn%
%X1
    \if*\Ismn%
%X2
   \else\gdef\@isnbox{\typesetorbreak{\IsnBefore\@ismnbox\IsnAfter}\unskip}%
%X3
    \fi%
   \else%
%X4
    \if*\Ismn%
%X6
 	\typesetorbreak{\IsnBefore\@isbnbox\IsnAfter}%
      \else%
%X5
\gdef\@isnbox{\typesetorbreak{\IsnBefore\@isbnbox,} \typesetorbreak{%
\@ismnbox\IsnAfter}}%
    \fi%
\fi%
}%
%
\def\@issbmnbox{\if*\Issn\else%
\if*\Ismn%
  \if*\Isbn\typesetorbreak{\IsnBefore\@issnbox\IsnAfter}%
    \else\typesetorbreak{\IsnBefore\@issnbox,} \typesetorbreak{\@isbnbox\IsnAfter}%
  \fi%
\else%
  \if*\Isbn\
    \else\typesetorbreak{\IsnBefore\@issnbox,} \typesetorbreak{\@isbnbox\IsnAfter}, \typesetorbreak{\@isnbox\IsnAfter}%
  \fi%
\fi%
\fi%
}%
%
\def\@isnbiblbox{%
  \if A\biblTyp\@isbmnbox\else%
%  \if B\biblTyp\@issnbox\else% dodělat
  \if C\biblTyp\@isbmnbox\else%
  \if D\biblTyp\@isbmnbox\else%
  \if E\biblTyp\@issbmnbox%  
  \fi\fi\fi\fi}%
%
\def\budeisbn{+}\if*\Issn\if*\Isbn\if*\Ismn\def\budeisbn{-}\fi\fi\fi%
\if+\budeisbn\pomocnycrlf\penalty-1000\@isnbiblbox%
\fi}

\gdef\online#1{\@onlinetrue\gdef\Datumcitace{ [cit. \penalty500 #1].}}
\def\cit[#1]{\online{#1}}

%%% INITIALISATION -- SPECIFIC

\gdef\Www{*}%
\gdef\www#1{%
\ifwwwadditive % hvězdička je privátní řešení, nutno zobecnit
%\message{ADITIVE}%
	\if*\Www\gdef\Www{%\penalty-9999
		XXX\typesetorbreak%NOTE003-
		{\fontdostupnost\Dostupne}\penalty-5000 na:\penalty-5000 {\fonturi\bib@url{#1}}}
	  \else\let\W@wwpom=\Www\gdef\Www{{\fonturi\bib@url{\W@wwpom}}\penalty10000,%
		{\fontdostupnost\penalty-9999\ %\privatnipenalta
			{}\Dostupnetez:} {\fonturi\bib@url{#1}}}
	\fi% 
  \else
%\message{SINGLE}%
\gdef\Www{{\fontdostupnost\penalty-9999\Dostupne:\ifbib@wwwbreakat\crlf\fi}
{\fonturi\bib@url{#1}}}%
\fi%
}

%%% Definice výstupních elementů

\def\biblDil{\if*\Dil\else\bib@space\Dil\unskip\@Tecka\fi}

\def\biblNazev{\Nazev\unskip\if*\Podnazev\else\bib@space:\bib@space\Podnazev\unskip\fi%
  \if G\biblTyp\else\if H\biblTyp\else
  \if@online%\bib@space
    \bibtext@online\@teckatrue\else%
    \if*\Nazevdok\ifbib@cdrom\cdromtext\fi\fi
  \fi\unskip%
  \fi\fi%
  \if C\biblTyp\else\@Tecka\fi%
}
%\def\biblNazev{\Nazev\unskip\if@online\bib@space\bibtext@online\fi\unskip\@Tecka}

\def\biblNazevdok{\Nazevdok\unskip\if*\Podnazevdok\else\bib@space:\bib@space\Podnazevdok\unskip\fi\ifbib@cdrom\bib@space\cdromtext\fi\unskip\if E\biblTyp\else\if@tecka.\fi\fi}
\def\biblAutor{\ifautor@bib\Autori\if*\Autorii\else\bib@authordelim\bib@space\Autorii\if*\Autoriii\else\bib@authordelim\bib@space\Autoriii\fi\fi\ifbib@authorfullname.\fi\bib@spaceaut\fi}
\def\biblAutorC{\ifautor@bib\Autori\if*\Autorii\else\bib@authordelim\bib@space\Autorii\if*\Autoriii\else\bib@authordelim\bib@space\Autoriii\fi\fi\ifbib@authorfullname.\fi\fi}
\def\biblAutordok{\ifautor@bib\Autordoki\if*\Autordokii\else\bib@authordelim\bib@space\Autordokii\if*\Autordokiii\else\bib@authordelim\bib@space\Autordokiii\fi\fi\ifbib@authordokfullname.\fi\bib@space\fi}
\def\biblMajitel{\Majitel\ifbib@authorfullname.\fi\bib@spaceaut}

\def\biblPodpov{\if*\Podpov\else\bib@space\Podpov\unskip\@Tecka\bib@space\fi}

\def\@biblnakl{\Sidlo{}\bib@space:\bib@space\Nakla}  

\def\biblNakl{%\ifNakladatel\if@vtisku
%\unskip\penalty-9999\ 
\if*\Sidlo\if*\Nakla\else{}\Nakla,\fi%
  \else\if*\Nakla{}\Sidlo\else\@biblnakl\fi,%
\fi}

\def\biblEdice{\ifBIBSTYediceuvadime Edice \Edice\unskip, sv.\,\Svazek\unskip\@Tecka\fi}

\def\biblVyd{\if@vtisku\else\if*\Vyd%
%{\ifBIBSTYvydaninepovinne
  \else\Vyd\@Tecka~\vydanitext\bib@space%\fi%}
  \fi\fi} % 
\def\biblRok{\Rok}
\def\biblMeritko{\meritkotext: \Meritko}
\def\biblCit{\if@online\unskip%\bib@space
	\Datumcitace\unskip%\bib@space
	\fi} % 
\def\biblDatCit{\Datumcitace}
% původní <=2.559: \def\biblUmist{\if@vtisku{} (\pressname)\else\if@online\else\unskip, \biblumistpagesname\,\Umist\fi\fi}
\def\biblUmist{\if@vtisku{} (\pressname)\else\if@online\if0\the\UmistOd\else\unskip, \biblumistpagesname\,\Umist\fi
   \biblCit\else, \biblumistpagesname\,\Umist.\fi\fi}

\def\biblCast{\if@vtisku\else\if E\biblTyp\unskip,\bib@space\Cast\else\if C\biblTyp\if*\Cast\else\bib@space\Cast\fi\fi\fi\fi}
\def\biblThesis{(\Thesis.)}
\def\biblVedouci{\vedouciprace: \Vedouci.}

\def\biblPozn{\if*\Pozn\else\bib@space\Pozn\unskip\@Tecka\fi}
\def\biblWww{\if*\Www\else\bib@space\Www\unskip\@Tecka\fi}

%%% Inicializace (příprava)

\def\newField#1#2 {\uppercase{\def\pom{#1}}
  \expandafter\def\csname#1#2\expandafter\endcsname
  \expandafter{\expandafter\gdef\csname\pom#2\endcsname}
  \expandafter\csname#1#2\expandafter\endcsname{*}
}

\def\forEach{\let\next=\opakuj \next}
\def\opakuj #1{\if :#1\let\next=\relax
        \else \message{#1} 
	\newField#1 %
        \fi \next}

%%% INITIALISATION -- GENERAL

\def\BIBSTY@init#1{\gdef\biblTyp{#1}%
  \BIBSTY@auxmacros%
  \@vtiskufalse\@onlinefalse\autor@bibtrue%
  \@teckatrue\@fondtrue%
  \forEach{autori}{autorii}{autoriii}{autordoki}{autordokii}{autordokiii}
  {nazev}{podnazev}{nazevdok}{podnazevdok}{podpov}{vyd}{cast}{nakla}{sidlo}{rok}{meritko}
  {doi}{rozsah}{dil}{edice}{svazek}{pozn}{private}%{isbn}{issn}{ismn}%{www}
  {vedouci}{thesis}{datumcitace}{verze}{ref}{majitel}: % : je důležitá
  % Isxn vyřazeno kvůli CTX  TL2017
  \gdef\Isbn{*}
  \gdef\Issn{*}%
  \gdef\Ismn{*}%
  \gdef\Autori{*}%
  \gdef\Autorii{*}%
  \gdef\Autoriii{*}%
  \gdef\Autordoki{*}%
  \gdef\Autordokii{*}%
  \gdef\Autordokiii{*}%
  \Nakladatelfalse\if*\Nakla\else\if*\Sidlo\else\Nakladateltrue\fi\fi
  \gdef\Umist{*}\UmistOd=0\UmistDo=0% Dořešit LTX
  \gdef\Www{*}%
  \ifBIBSTYreport\BIBSTYreporttype\fi%
}

%%% SHORT CUTS

\def\ISBN#1.{\isbn{#1}}
\def\ISMN#1.{\ismn{#1}}
\def\ISSN#1.{\issn{#1}}
\gdef\nakl#1#2{\gdef\Nakla{#2}\gdef\Sidlo{#1}}
%\gdef\naklang#1#2{\gdef\Naklang{#2}\gdef\Sidloang{#1}}
\let\WWW=\www

%%% ---

%%% DEFINE KINDS OF REFERENCES

\def\nopubl#1\par{\unskip}
\def\publA#1{\BIBSTY@init{A}#1{\BIBSTY@uselanguage\BIBSTY@testA\BIBSTY@doneA}}
\def\publB#1{\BIBSTY@init{B}#1{\BIBSTY@uselanguage\BIBSTY@testB\BIBSTY@doneB}}
\def\publC#1{\BIBSTY@init{C}#1{\BIBSTY@uselanguage\BIBSTY@testC\BIBSTY@doneC}}
\def\publD#1{\BIBSTY@init{D}#1{\BIBSTY@uselanguage\BIBSTY@testD\BIBSTY@doneD}}
\def\publDA#1{\BIBSTY@init{D}#1{\BIBSTY@uselanguage\BIBSTY@testD\BIBSTY@doneD}}
\def\publE#1{\BIBSTY@init{E}#1{\BIBSTY@uselanguage\BIBSTY@testE\BIBSTY@doneE}}
\def\publEA#1{\BIBSTY@init{E}#1{\BIBSTY@uselanguage\BIBSTY@testE\BIBSTY@doneE}}
\def\publG#1{\BIBSTY@init{G}#1{\BIBSTY@uselanguage\BIBSTY@testG\BIBSTY@doneG}}
\def\publH#1{\BIBSTY@init{H}#1{\BIBSTY@uselanguage\BIBSTY@testH\BIBSTY@doneH}}
\def\publM#1{\BIBSTY@init{M}#1{\BIBSTY@uselanguage\BIBSTY@testM\BIBSTY@doneM}}
\def\publN#1{\BIBSTY@init{N}#1{\BIBSTY@uselanguage\BIBSTY@testN\BIBSTY@doneN}}
\def\publO#1{\BIBSTY@init{O}#1{\BIBSTY@uselanguage\BIBSTY@testN\BIBSTY@doneO}}
\def\publP#1{\BIBSTY@init{P}#1{\BIBSTY@uselanguage\BIBSTY@testP\BIBSTY@doneP}}
\def\publS#1{\BIBSTY@init{S}#1{\BIBSTY@uselanguage\BIBSTY@testS\BIBSTY@doneS}}
\def\publT#1{\BIBSTY@init{T}#1{\BIBSTY@uselanguage\BIBSTY@testT\BIBSTY@doneT}}
\def\publX#1{\BIBSTY@init{X}#1{\BIBSTY@uselanguage\BIBSTY@testX\BIBSTY@doneX}}
\def\publXX#1{\BIBSTY@init{X}#1{\BIBSTY@uselanguage\BIBSTY@testX\BIBSTY@doneX}}
\def\publW#1{\BIBSTY@init{W}#1{\BIBSTY@uselanguage\BIBSTY@testW\BIBSTY@doneW}}
\def\publZ#1{\BIBSTY@init{Z}#1{\BIBSTY@uselanguage\BIBSTY@testZ\BIBSTY@doneZ}} %\autor@bibfalse

%%% DEFINE OUTPUT / CITATION STYLE

\def\BIBSTY@doneA{\def\@tisk{\fontcitace{\fontautor\biblAutor}%
  {\fontnazev\biblNazev}\bib@space\biblVyd\biblPodpov%
  \biblNakl\bib@space\biblRok.%
  \if*\Datumcitace\else\bib@space\biblCit\fi%.  
  \if*\Rozsah\else\bib@space\Rozsah\fi%
  \biblEdice%
  \bib@space\biblISN%
  \biblWww%
  \biblPozn%
  }\@bibakce{\@tisk\unskip}\@bibclear}%

\def\BIBSTY@doneB{\def\@tisk{\fontcitace{\fontautor\biblAutor}%
 {\fontnazev\biblNazevdok}\bib@space\biblVyd
  \biblCast\bib@space%
  \biblNakl\bib@space\biblRok.\biblCit %.
  \if*\Rozsah.\else,\bib@space\Rozsah\fi%
  \biblWww%
  \bib@spaceisbn\bib@space\Issn%
  }\@bibakce{\@tisk}\bib@clear}

\def\BIBSTY@doneC{\def\@tisk{{\fontautor\biblAutordok}\bib@space%
  {\fontnazev\biblNazevdok}\biblDil\bib@space%
  \unskip\biblPodpov\bib@space\if*\Vyd\else\biblVyd\bib@space\fi%
  \biblPodpov\bib@space\biblNakl\bib@space\biblRok.%
  \biblCast.\bib@space
%
  \fontcitace{\ifx\Autordoki\Autori\else{\fontautor\biblAutorC}\bib@space\fi}% dodělat mezeru pro jiné případy
  {\fontnazev\biblNazev}\if*\Www\biblUmist\fi\biblCit%.dodo
  \biblWww%
  \bib@spaceisbn\biblISN%
  \if*\Pozn\else\Pozn.\bib@space\fi
  }\@bibakce{\@tisk}\@bibclear}%

\def\BIBSTY@doneD{\def\@tisk{\fontcitace{\fontautor\biblAutor}%
  \biblNazev\bib@space\In\ %
  \if*\Autordoki\else{\fontautor\biblAutordok}\fi\bib@space%
  {\fontnazev\biblNazevdok}\bib@space%
  \if*\Cast\else\BIBSTYerrmessage{Typ D: Obsahuje atribut Cast./Type D: Extra attribute Part.}%\biblCast	
	\fi% 
  \kern0.1em\biblVyd%\bib@space%
  \biblNakl\bib@space\biblRok%
% biblCast je pro tzv. nepravidelně vycházející periodika  2011-05-01
  \biblUmist\if@online\biblCit\fi%.
  \bib@spaceisbn\bib@space\biblISN%
  \biblWww%
  }\@bibakce{\@tisk}\@bibclear}%

\def\BIBSTY@doneE{\def\@tisk{\fontcitace{\fontautor\biblAutor}%
  \biblNazev\bib@space{\fontnazev\biblNazevdok}, %biblNazevdokE
  \biblRok\biblCast\biblUmist%
  \bib@spaceisbn\biblISN%\fi%
  \biblWww%
  }\@bibakce{\@tisk}\@bibclear}%

\def\BIBSTY@doneG{\def\@tisk{\fontcitace{\fontautor\biblAutor}%
\errmessage{Not implemented yet.}
  {\fontnazev\biblNazev}\bib@space\biblPozn\biblPodpov\bib@space\biblNakl\biblRok.%
  }\@bibakce{\@tisk}\@bibclear}%

\def\BIBSTY@doneH{\def\@tisk{\fontcitace{\fontautor\biblAutor}%
\errmessage{Not implemented yet.}
  {\fontnazev\biblNazev}\biblPodpov\bib@space\biblPozn\if*\Rok\bib@space\biblRok.\fi%
  }\@bibakce{\@tisk}\@bibclear}%

\def\BIBSTY@doneM{\def\@tisk{\fontcitace{\fontautor\biblAutor}%
  {\fontnazev\biblNazev}\bib@space{\biblMeritko.}\bib@space\biblVyd%
  \biblPodpov\biblNakl\bib@space\biblRok.%
  \if*\Datumcitace\else\bib@space\biblCit\fi%.
  \if*\Rozsah\else\bib@space\Rozsah\fi\bib@spaceisbn\bib@space\biblISN%
  \biblWww%
  }\@bibakce{\@tisk}\@bibclear}%

\def\BIBSTY@doneN{\def\@tisk{\fontcitace\ifautor@bib\if*\Autori\else{\fontautor\biblAutor}\fi\fi
 {\fontnazev\biblNazev} \biblVyd
  \biblNakl\bib@space\biblRok%
	\biblCit%
  \if*\Rozsah.\else, \Rozsah\fi{} %
  \biblWww%
%  \if*\Isbn\else\bib@spaceisbn\bib@space\ISBN.\fi%
  }\@bibakce{\@tisk}\@bibclear
}

\def\BIBSTY@doneO{\def\@tisk{\fontcitace{\fontautor\biblAutor}%
  \biblNazev\bib@space %
%  \if*\Autordoki\else{\fontautor\biblAutordok}\fi\bib@space%
\if@fond
  {\fontnazev\biblNazevdok}\bib@space%
  \Cast\bib@space%
\fi%
  \ifnum0=\UmistOd\else\biblumistpagesname\,\Umist.\bib@space\fi%\if@online\biblCit\fi%.
  \biblNakl\bib@space\biblRok\if@online\Datumcitace\else.\fi%
  \biblWww%
  }\@bibakce{\@tisk}\@bibclear
}%


\def\BIBSTY@doneP{\def\@tisk{\fontcitace{\fontautor\biblMajitel}%
  {\fontnazev\biblNazev}\bib@space\if*\Autori\else{\def\bib@spaceaut{}\biblAutor}.\bib@space\fi%
  \biblPozn\Sidlo,\bib@space\biblNazevdok\bib@space%
  \biblRok.\biblWww%
  }\@bibakce{\@tisk}\@bibclear}%

\def\BIBSTY@doneS{\def\@tisk{\fontcitace{\if*\Autori\else{\fontautor\biblAutor}\fi}%
  {\fontnazev\biblNazev}\bib@space%\if*\Vyd\else\biblVyd\fi{}
  %\if*\Verze\else
	{\fontnazev\textVerze\Verze}.
  \if*\Podnazev\else {\Podnazev}.\fi{}
%\fi%\if*\Vyd\else\biblVyd\fi{}
  \biblPodpov\biblNakl\bib@space%\biblRok%
  \if*\Rok\biblCit\else\biblRok.%
  \fi%
%  \if@online\biblCit\fi%\@Tecka  %%%%%%%%%%%
%  \if*\Pozn\else\Pozn.\bib@space\fi%
%  \if*\Rozsah\else\bib@space\Rozsah\fi%
  \biblWww%
  }\@bibakce{\@tisk}\@bibclear 
}

\def\BIBSTY@doneT{\def\@tisk{\fontcitace{\fontautor\biblAutor}%
 {\fontnazev\biblNazev} %\biblVyd
  \biblThesis\bib@space\biblPodpov\biblNakl\bib@space\biblRok.\biblCit%. 
  \if*\Rozsah.\else\bib@space\Rozsah\fi%
  \if*\Vedouci\else\bib@space\biblVedouci\fi%
  \biblWww%
  }\@bibakce{\@tisk}\@bibclear
}

\def\BIBSTY@doneW{\def\@tisk{\fontcitace{\fontautor\biblAutor}%
  \biblNazev\bib@space\In\ %
  \if*\Autordoki\else{\fontautor\biblAutordok}\fi\bib@space%
  {\fontnazev\biblNazevdok}\bib@space%
  %\biblVyd%\bib@space%
  \biblPodpov\biblNakl\bib@space\biblRok%
  %\biblUmist. 
  \bib@space\biblCit%.
  %\bib@spaceisbn\bib@space\biblISN%
  \bib@space\biblWww%
  }\@bibakce{\@tisk}\@bibclear}

\def\BIBSTY@doneX{\def\@tisk{\fontcitace{\fontautor\biblAutor}%
\if*\Nazev\else{\fontnazev\biblNazev}\bib@space\fi%\if*\Vyd\else\biblVyd\fi{}
  \biblNakl\bib@space%\biblRok%
  \if*\Rok\biblCit\else\biblRok.%
   %\if@online
\biblCit%\fi%\@Tecka
  \fi%
  \if*\Pozn\else\bib@space\Pozn.\fi%
  \if*\Rozsah\else\bib@space\Rozsah\fi%
  \biblWww%
  }\@bibakce{\@tisk}\@bibclear 
}

\def\BIBSTY@doneXX{\def\@tisk{\fontcitace{\if*\Autori\else{\fontautor\biblAutor}\fi}
\if*\Nazev\else{\fontnazev\biblNazev}\bib@space\fi%\if*\Vyd\else\biblVyd\fi{}
  %\ifNakladatel\Sidlo\,: \Nakla,\fi{}
   %  \biblNakl, %privátní tisky nemají nakladatele
  \if*\Rok\biblCit\else\Rok\biblCit\@Tecka\bib@space\fi % Tečka nezkontrolována
  \if*\Pozn\else\Pozn.\bib@space\fi
  \if*\Rozsah\else\Rozsah\fi
  \biblWww%
  }\@bibakce{\@tisk}\@bibclear 
}		

\def\BIBSTY@doneZ{\def\@tisk{\fontcitace\if*\Autori\else{\fontautor\biblAutor}\fi%
  {\fontnazev\biblNazev}%
  \if*\Rok\else\bib@space\Rok.\fi\bib@space%
  \biblDatCit\bib@space%\@Tecka
  \if*\Pozn\else\Pozn.\bib@space\fi%
  \biblWww%
  }\@bibakce{\@tisk}\@bibclear
}


\def\bakprace{\gdef\Thesis{Bakalářská práce}}
\def\dipprace{\gdef\Thesis{Diplomová práce}}
\def\disprace{\gdef\Thesis{Disertační práce}}
\def\phdthesis{\gdef\Thesis{PhD thesis}}\let\PhDthesis=\phdthesis
\def\habprace{\gdef\Thesis{Habilitační práce}}


%%% SHORT CUTS

\def\konvoj{\nakl{Brno}{Konvoj}}
\def\zcstug{\nazevdok{Zpravodaj CSTUG} \issn{1211-6661}}
\def\zcstuge{\nazevdok{Zpravodaj CSTUG} \issn{1213-8185} \www{bulletin.cstug.cz}}

%%% FONTS

\ifConTeXt
  \def\emphsc#1{{\smallcaps#1}}
  \def\emphtt#1{{\fonturi#1}}
  \def\fontautor{\smallcaps}
  \def\fontautordod{\smallcaps}
  \def\fontautorkorp{\fontautor}
  \def\fontcitace{\rm\tf}
  \def\fontdostupnost{\rm\tf}
  \def\fontonlinetext{\rm\tf} \let\fontbibtext@online=\fontonlinetext
  \def\fontnazev{\it}
%  \def\fonturi{\tt}
\def\fonturi{%\switchtobodyfont[modern]
%\tt
%\blue
\rm\tf} %,mono
  \def\fontmeritko{\rm\tf}
  \def\fontISNtext{}
\else\ifLaTeX
  \def\emphsc#1{{\scshape#1}}
  \def\emphtt#1{{\fonturi#1}}
  \def\fontautor{\scshape}
  \def\fontautordod{\scshape}
  \def\fontautorkorp{\fontautor\upshape}
  \def\fontcitace{\mdseries\upshape} 
  \def\fontonlinetext{\mdseries\upshape} \let\fontbibtext@online=\fontonlinetext
  \def\fontdostupnost{\mdseries\upshape}
  \def\fontnazev{\itshape}
  \def\fonturi{\mdseries\ttfamily}
  \def\fontmeritko{\mdseries\upshape}
  \def\fontIStext{\rmfamily\scshape}
\else
  \def\emphsc#1{{\sc#1}}
  \def\emphtt#1{{\fonturi#1}}
  \def\sc{}
  \def\,{ }
  \def\fontautor{\sc}
  \def\fontautordod{\sc}
  \def\fontautorkorp{\rm}
  \def\fontcitace{\rm}
  \def\fontonlinetext{\rm} \let\fontbibtext@online=\fontonlinetext
  \def\fontdostupnost{\rm}
  \def\fontnazev{\it}
  \def\fonturi{\tt}
  \def\fontmeritko{\rm}
  \def\fontIStext{\rm}
\fi\fi

\newif\ifbib@wwwbreakat\bib@wwwbreakatfalse

%%% 

\gdef\mnoho@autoru{-}

%%%

%%% Definice vlastností položky soupisu

\long\gdef\@bibakcenormalni#1{\itembib#1}
\gdef\@bibakce#1{\@bibakcenormalni#1}

%\gdef\itembib{\item%[\Ref]  % Toto je v bádání...
% FOR LATEX ONLY \hspace*{-2.932em}
%} % shodně v bib.sty

%%% bbib for PLAIN

\def\bbibTEX{\par\noindent{{\it\refname}}\def\itembib{}%
   \leftskip2em\parskip0pt\parindent-2em\def\bibitem##1{}}
\def\ebibTEX{\par}

%%% bbib for LATEX

\def\refnamecmd{\subsubsection*} % kvůli LTX

\def\bbibLTX{\refnamecmd{\refname}%\begin{flushleft}
  \gdef\itembib{}%\item[]}
  % \begin{itemize}
  \leftskip2em
  %\setlength{\leftmargini}{-2em} 
  \parindent-2em%\leftskip
  %\itemsep0pt
  \parsep0pt\parskip0pt\def\bibitem##1{}
  \long\gdef\@bibakcenormalni##1{\itembib ##1}
\noindent}

\def\ebibLTX{}%\end{itemize}%\end{flushleft}

\def\bBibLTX{\subsubsection*{\refname}\begin{flushleft}\def\refname{}
 \vspace{-2\baselineskip}
 \begin{thebibliography}{99}\footnotesize
 \long\gdef\@bibakcenormalni##1{##1}
}
\def\eBibLTX{\end{thebibliography}\end{flushleft}}

%%% bbib for CONTEXT

\def\bBibCTX#1{%
  \gdef\itembib{\par\leftskip3.75em\parindent-\leftskip} %NOTE002+ OK pro ctx-thesis 
  %\setupitemize[left=[,right={]},width=2.33333em] %2em for three figures and both brackets %NOTE002- předsazeno u ctx-thesis
  \BIBSTYrefs{#1}
  \writetolist[chapter]{}{#1} % Tady musí být chapter, proč nefunguje BIBSTYrefs nevím...
  %   \leftskip2em\parskip0pt\parindent-2em
  \startitemize[broad]
  \noindent
}
%\def\bbibitemlabel#1{[#1]}
%\def\bbibCTX{\gdef\itembib{\par\leftskip2em\parindent-1.25\leftskip} %NOTE002+ OK pro ctx-thesis 

\def\bbibCTX{\bBibCTX{\refname}}
\def\eBibCTX{\stopitemize}
\let\ebibCTX=\eBibCTX

%%% bbib PUBLIC

\def\bbib{\bgroup\BIBSTY@init{-}\ifConTeXt\bbibCTX\else\ifLaTeX\ifx\BIBSTYrefnamecmd\undefined\let\BIBSTYrefnamecmd=\chapter\fi\bbibLTX\else\bbibTEX\fi\fi}
\def\ebib{\ifConTeXt\ebibCTX\else\ifLaTeX\ebibLTX\else\ebibTEX\fi\fi\egroup}
\def\bBib#1{\bgroup\BIBSTY@init{-}\ifConTeXt\bBibCTX{#1}\else\ifLaTeX\ifx\BIBSTYrefnamecmd\undefined\let\BIBSTYrefnamecmd=\chapter\fi\BbibLTX\else\bbibTEX\fi\fi}
\def\eBib{\ifConTeXt\eBibCTX\else\ifLaTeX\eBibLTX\else\ebibTEX\fi\fi\egroup}
\let\startbib=\bbib
\let\stopbib=\ebib
\let\startBib=\bBib
\let\stopBib=\eBib

\def\@bibclear{\bib@cdromfalse\bib@wwwbreakatfalse\gdef\W@wwpom{*}}
\@bibclear

%\ifConTeXt % kvůli TL2017
\def\bib@spaceisbn{\hbox to 0.4em{}}
\let\curisbn=\isbn
\let\curissn=\issn
\let\curismn=\ismn
\def\isbn#1{\def\pomocnycrlf{}{\curisbn{\startcolor[black]#1\stopcolor}}}
\def\xisbn#1{\def\pomocnycrlf{\crlf}\def\bib@spaceisbn{}{\curisbn{\startcolor[black]#1\stopcolor}}}
\def\issn#1{\def\pomocnycrlf{}{\curissn{\startcolor[black]#1\stopcolor}}}
\def\xissn#1{\def\pomocnycrlf{\crlf}{\curissn{\startcolor[black]#1\stopcolor}}}
\def\ismn#1{\def\pomocnycrlf{}{\curismn{\startcolor[black]#1\stopcolor}}}
\def\xismn#1{\def\pomocnycrlf{\crlf}{\curismn{\startcolor[black]#1\stopcolor}}}

%\catcode`\@=12

\endinput
%%% ===================================================================================================================================================
